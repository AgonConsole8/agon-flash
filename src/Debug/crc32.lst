Zilog eZ80 Macro Assembler Version 4.3 (19073001) RELISTED14-Oct-23     15:06:03     page:   1


PC     Object              I  Line    Source 
                           A     1    ;
                           A     2    ; Title:	crc32
                           A     3    ; Author:	Leigh Brown
                           A     4    ; Created:	26/05/2023
                           A     5    ; Last Updated:	14/10/2023
                           A     6    
                           A     7    ; Modinfo
                           A     8    ;	crc32 can handle different blocks now
                           A     9    
                           A    10    	XDEF	_crc32
                           A    11    	XDEF	_crc32_initialize
                           A    12    	XDEF	_crc32_finalize
                           A    13    
                           A    14    	.ASSUME ADL = 1
                           A    15    	SEGMENT		CODE
                           A    16    
                           A    17    ; UINT32 crc32(const char *s, UINT24 len);
                           A    18    ;              IX+6           IX+9
                           A    19    ; NB: We use local stack storage without alloca
                           A    20    ;     That's okay, /as long as/ we don't call a
                           A    21    
                           A    22    	SCOPE
                           A    23    
0B0E99                     A    24    _crc32_initialize:
                           A    25        ; Initialise output to 0xFFFFFFFF
0B0E99 D9                  A    26        EXX
0B0E9A 3EFF                A    27        LD  A, FFh
0B0E9C 32 03 20 0B         A    28        LD  (crc32result+3), A
0B0EA0 32 02 20 0B         A    29        LD  (crc32result+2), A
0B0EA4 32 01 20 0B         A    30        LD  (crc32result+1), A
0B0EA8 32 00 20 0B         A    31        LD  (crc32result), A
0B0EAC D9                  A    32        EXX
0B0EAD C9                  A    33        RET
                           A    34    
0B0EAE                     A    35    _crc32_finalize:
0B0EAE DDE5                A    36    	PUSH	IX
0B0EB0 DD210000 00         A    37    	LD		IX,0
0B0EB5 DD39                A    38    	ADD		IX,SP
                           A    39    
0B0EB7 3A 03 20 0B         A    40        LD  A, (crc32result+3)
0B0EBB 2F                  A    41        CPL
0B0EBC 32 03 20 0B         A    42        LD  (crc32result+3), A
0B0EC0 3A 02 20 0B         A    43        LD  A, (crc32result+2)
0B0EC4 2F                  A    44        CPL
0B0EC5 32 02 20 0B         A    45        LD  (crc32result+2), A
0B0EC9 3A 01 20 0B         A    46        LD  A, (crc32result+1)
0B0ECD 2F                  A    47        CPL
0B0ECE 32 01 20 0B         A    48        LD  (crc32result+1), A
0B0ED2 3A 00 20 0B         A    49        LD  A, (crc32result)
0B0ED6 2F                  A    50        CPL
0B0ED7 32 00 20 0B         A    51        LD  (crc32result), A
                           A    52    
0B0EDB 3A 03 20 0B         A    53    	LD	A, (crc32result+3)
0B0EDF 11000000            A    54    	LD	DE, 0
0B0EE3 5F                  A    55    	LD	E, A
0B0EE4 2A 00 20 0B         A    56    	LD	HL, (crc32result)
0B0EE8 DDE1                A    57    	POP	IX
0B0EEA C9                  A    58    	RET
                           A    59    
0B0EEB                     A    60    _crc32:
                           A    61    	; Function prologue
0B0EEB DDE5                A    62    	PUSH	IX
0B0EED DD210000 00         A    63    	LD		IX,0
0B0EF2 DD39                A    64    	ADD		IX,SP
                           A    65    
0B0EF4 DD1706              A    66    	LD		DE, (IX+6)
0B0EF7 DD2709              A    67    	LD		HL, (IX+9)
                           A    68    ; expects DE to point to buffer to check
                           A    69    ; expects HL to contain the bytecount
0B0EFA 01010000            A    70        LD		BC,1
                           A    71    
0B0EFE D9                  A    72        EXX
0B0EFF 3A 03 20 0B         A    73        LD A, (crc32result+3)
0B0F03 57                  A    74        LD D, A
0B0F04 3A 02 20 0B         A    75        LD A, (crc32result+2)
0B0F08 5F                  A    76        LD E, A
0B0F09 3A 01 20 0B         A    77        LD A, (crc32result+1)
0B0F0D 47                  A    78        LD B, A
0B0F0E 3A 00 20 0B         A    79        LD A, (crc32result)
0B0F12 4F                  A    80        LD C, A
0B0F13 D9                  A    81        EXX
                           A    82    
0B0F14                     A    83    $$:	
0B0F14 1A                  A    84        LD	A,(DE)
0B0F15 13                  A    85        INC	DE
                           A    86        
                           A    87        ; Calculate offset into lookup table
0B0F16 D9                  A    88        EXX
0B0F17 A9                  A    89        XOR	C
0B0F18 21 00 C7 02         A    90        LD	HL,crc32_lookup_table >> 2
0B0F1C 6F                  A    91        LD	L,A
0B0F1D 29                  A    92        ADD	HL,HL
0B0F1E 29                  A    93        ADD	HL,HL
                           A    94    
0B0F1F 78                  A    95        LD	A,B
0B0F20 AE                  A    96        XOR	(HL)
0B0F21 23                  A    97        INC	HL
0B0F22 4F                  A    98        LD	C,A
                           A    99    
0B0F23 7B                  A   100        LD	A,E
0B0F24 AE                  A   101        XOR	(HL)
0B0F25 23                  A   102        INC	HL
0B0F26 47                  A   103        LD	B,A
                           A   104    
0B0F27 7A                  A   105        LD	A,D
0B0F28 AE                  A   106        XOR	(HL)
0B0F29 23                  A   107        INC	HL
0B0F2A 5F                  A   108        LD	E,A
                           A   109    
0B0F2B 56                  A   110        LD	D,(HL)
0B0F2C D9                  A   111        EXX
                           A   112    
                           A   113        ; Decrement count and loop if not zero
0B0F2D B7                  A   114        OR	A,A
0B0F2E ED42                A   115        SBC	HL,BC
0B0F30 20 E2               A   116        JR	NZ,$B
                           A   117    
0B0F32 D9                  A   118        EXX
0B0F33 7A                  A   119        LD  A, D
0B0F34 32 03 20 0B         A   120        LD  (crc32result+3), A
0B0F38 7B                  A   121        LD  A, E
0B0F39 32 02 20 0B         A   122        LD  (crc32result+2), A
0B0F3D 78                  A   123        LD  A, B
0B0F3E 32 01 20 0B         A   124        LD  (crc32result+1), A
0B0F42 79                  A   125        LD  A, C
0B0F43 32 00 20 0B         A   126        LD  (crc32result), A
0B0F47 D9                  A   127        EXX
                           A   128    
                           A   129    	; Function epilogue
0B0F48 DDE1                A   130    	POP	IX
0B0F4A C9                  A   131    	RET
                           A   132    
                           A   133    		SEGMENT	DATA
                           A   134    
                           A   135    		; The crc32 routine is optimised in suc
                           A   136    		; the following table to be aligned on 
                           A   137    
                           A   138    		ALIGN	1024
0B1C00                     A   139    crc32_lookup_table:
0B1C00 00000000 96300777   A   140    		DL	%00000000, %77073096, %ee0e612c, %9
0B1C08 2C610EEE BA510999 
0B1C10 19C46D07 8FF46A70   A   141    		DL	%076dc419, %706af48f, %e963a535, %9
0B1C18 35A563E9 A395649E 
0B1C20 3288DB0E A4B8DC79   A   142    		DL	%0edb8832, %79dcb8a4, %e0d5e91e, %9
0B1C28 1EE9D5E0 88D9D297 
0B1C30 2B4CB609 BD7CB17E   A   143    		DL	%09b64c2b, %7eb17cbd, %e7b82d07, %9
0B1C38 072DB8E7 911DBF90 
0B1C40 6410B71D F220B06A   A   144    		DL	%1db71064, %6ab020f2, %f3b97148, %8
0B1C48 4871B9F3 DE41BE84 
0B1C50 7DD4DA1A EBE4DD6D   A   145    		DL	%1adad47d, %6ddde4eb, %f4d4b551, %8
0B1C58 51B5D4F4 C785D383 
0B1C60 56986C13 C0A86B64   A   146    		DL	%136c9856, %646ba8c0, %fd62f97a, %8
0B1C68 7AF962FD ECC9658A 
0B1C70 4F5C0114 D96C0663   A   147    		DL	%14015c4f, %63066cd9, %fa0f3d63, %8
0B1C78 633D0FFA F50D088D 
0B1C80 C8206E3B 5E10694C   A   148    		DL	%3b6e20c8, %4c69105e, %d56041e4, %a
0B1C88 E44160D5 727167A2 
0B1C90 D1E4033C 47D4044B   A   149    		DL	%3c03e4d1, %4b04d447, %d20d85fd, %a
0B1C98 FD850DD2 6BB50AA5 
0B1CA0 FAA8B535 6C98B242   A   150    		DL	%35b5a8fa, %42b2986c, %dbbbc9d6, %a
0B1CA8 D6C9BBDB 40F9BCAC 
0B1CB0 E36CD832 755CDF45   A   151    		DL	%32d86ce3, %45df5c75, %dcd60dcf, %a
0B1CB8 CF0DD6DC 593DD1AB 
0B1CC0 AC30D926 3A00DE51   A   152    		DL	%26d930ac, %51de003a, %c8d75180, %b
0B1CC8 8051D7C8 1661D0BF 
0B1CD0 B5F4B421 23C4B356   A   153    		DL	%21b4f4b5, %56b3c423, %cfba9599, %b
0B1CD8 9995BACF 0FA5BDB8 
0B1CE0 9EB80228 0888055F   A   154    		DL	%2802b89e, %5f058808, %c60cd9b2, %b
0B1CE8 B2D90CC6 24E90BB1 
0B1CF0 877C6F2F 114C6858   A   155    		DL	%2f6f7c87, %58684c11, %c1611dab, %b
0B1CF8 AB1D61C1 3D2D66B6 
0B1D00 9041DC76 0671DB01   A   156    		DL	%76dc4190, %01db7106, %98d220bc, %e
0B1D08 BC20D298 2A10D5EF 
0B1D10 8985B171 1FB5B606   A   157    		DL	%71b18589, %06b6b51f, %9fbfe4a5, %e
0B1D18 A5E4BF9F 33D4B8E8 
0B1D20 A2C90778 34F9000F   A   158    		DL	%7807c9a2, %0f00f934, %9609a88e, %e
0B1D28 8EA80996 18980EE1 
0B1D30 BB0D6A7F 2D3D6D08   A   159    		DL	%7f6a0dbb, %086d3d2d, %91646c97, %e
0B1D38 976C6491 015C63E6 
0B1D40 F4516B6B 62616C1C   A   160    		DL	%6b6b51f4, %1c6c6162, %856530d8, %f
0B1D48 D8306585 4E0062F2 
0B1D50 ED95066C 7BA5011B   A   161    		DL	%6c0695ed, %1b01a57b, %8208f4c1, %f
0B1D58 C1F40882 57C40FF5 
0B1D60 C6D9B065 50E9B712   A   162    		DL	%65b0d9c6, %12b7e950, %8bbeb8ea, %f
0B1D68 EAB8BE8B 7C88B9FC 
0B1D70 DF1DDD62 492DDA15   A   163    		DL	%62dd1ddf, %15da2d49, %8cd37cf3, %f
0B1D78 F37CD38C 654CD4FB 
0B1D80 5861B24D CE51B53A   A   164    		DL	%4db26158, %3ab551ce, %a3bc0074, %d
0B1D88 7400BCA3 E230BBD4 
0B1D90 41A5DF4A D795D83D   A   165    		DL	%4adfa541, %3dd895d7, %a4d1c46d, %d
0B1D98 6DC4D1A4 FBF4D6D3 
0B1DA0 6AE96943 FCD96E34   A   166    		DL	%4369e96a, %346ed9fc, %ad678846, %d
0B1DA8 468867AD D0B860DA 
0B1DB0 732D0444 E51D0333   A   167    		DL	%44042d73, %33031de5, %aa0a4c5f, %d
0B1DB8 5F4C0AAA C97C0DDD 
0B1DC0 3C710550 AA410227   A   168    		DL	%5005713c, %270241aa, %be0b1010, %c
0B1DC8 10100BBE 86200CC9 
0B1DD0 25B56857 B3856F20   A   169    		DL	%5768b525, %206f85b3, %b966d409, %c
0B1DD8 09D466B9 9FE461CE 
0B1DE0 0EF9DE5E 98C9D929   A   170    		DL	%5edef90e, %29d9c998, %b0d09822, %c
0B1DE8 2298D0B0 B4A8D7C7 
0B1DF0 173DB359 810DB42E   A   171    		DL	%59b33d17, %2eb40d81, %b7bd5c3b, %c
0B1DF8 3B5CBDB7 AD6CBAC0 
0B1E00 2083B8ED B6B3BF9A   A   172    		DL	%edb88320, %9abfb3b6, %03b6e20c, %7
0B1E08 0CE2B603 9AD2B174 
0B1E10 3947D5EA AF77D29D   A   173    		DL	%ead54739, %9dd277af, %04db2615, %7
0B1E18 1526DB04 8316DC73 
0B1E20 120B63E3 843B6494   A   174    		DL	%e3630b12, %94643b84, %0d6d6a3e, %7
0B1E28 3E6A6D0D A85A6A7A 
0B1E30 0BCF0EE4 9DFF0993   A   175    		DL	%e40ecf0b, %9309ff9d, %0a00ae27, %7
0B1E38 27AE000A B19E077D 
0B1E40 44930FF0 D2A30887   A   176    		DL	%f00f9344, %8708a3d2, %1e01f268, %6
0B1E48 68F2011E FEC20669 
0B1E50 5D5762F7 CB676580   A   177    		DL	%f762575d, %806567cb, %196c3671, %6
0B1E58 71366C19 E7066B6E 
0B1E60 761BD4FE E02BD389   A   178    		DL	%fed41b76, %89d32be0, %10da7a5a, %6
0B1E68 5A7ADA10 CC4ADD67 
0B1E70 6FDFB9F9 F9EFBE8E   A   179    		DL	%f9b9df6f, %8ebeeff9, %17b7be43, %6
0B1E78 43BEB717 D58EB060 
0B1E80 E8A3D6D6 7E93D1A1   A   180    		DL	%d6d6a3e8, %a1d1937e, %38d8c2c4, %4
0B1E88 C4C2D838 52F2DF4F 
0B1E90 F167BBD1 6757BCA6   A   181    		DL	%d1bb67f1, %a6bc5767, %3fb506dd, %4
0B1E98 DD06B53F 4B36B248 
0B1EA0 DA2B0DD8 4C1B0AAF   A   182    		DL	%d80d2bda, %af0a1b4c, %36034af6, %4
0B1EA8 F64A0336 607A0441 
0B1EB0 C3EF60DF 55DF67A8   A   183    		DL	%df60efc3, %a867df55, %316e8eef, %4
0B1EB8 EF8E6E31 79BE6946 
0B1EC0 8CB361CB 1A8366BC   A   184    		DL	%cb61b38c, %bc66831a, %256fd2a0, %5
0B1EC8 A0D26F25 36E26852 
0B1ED0 95770CCC 03470BBB   A   185    		DL	%cc0c7795, %bb0b4703, %220216b9, %5
0B1ED8 B9160222 2F260555 
0B1EE0 BE3BBAC5 280BBDB2   A   186    		DL	%c5ba3bbe, %b2bd0b28, %2bb45a92, %5
0B1EE8 925AB42B 046AB35C 
0B1EF0 A7FFD7C2 31CFD0B5   A   187    		DL	%c2d7ffa7, %b5d0cf31, %2cd99e8b, %5
0B1EF8 8B9ED92C 1DAEDE5B 
0B1F00 B0C2649B 26F263EC   A   188    		DL	%9b64c2b0, %ec63f226, %756aa39c, %0
0B1F08 9CA36A75 0A936D02 
0B1F10 A906099C 3F360EEB   A   189    		DL	%9c0906a9, %eb0e363f, %72076785, %0
0B1F18 85670772 13570005 
0B1F20 824ABF95 147AB8E2   A   190    		DL	%95bf4a82, %e2b87a14, %7bb12bae, %0
0B1F28 AE2BB17B 381BB60C 
0B1F30 9B8ED292 0DBED5E5   A   191    		DL	%92d28e9b, %e5d5be0d, %7cdcefb7, %0
0B1F38 B7EFDC7C 21DFDB0B 
0B1F40 D4D2D386 42E2D4F1   A   192    		DL	%86d3d2d4, %f1d4e242, %68ddb3f8, %1
0B1F48 F8B3DD68 6E83DA1F 
0B1F50 CD16BE81 5B26B9F6   A   193    		DL	%81be16cd, %f6b9265b, %6fb077e1, %1
0B1F58 E177B06F 7747B718 
0B1F60 E65A0888 706A0FFF   A   194    		DL	%88085ae6, %ff0f6a70, %66063bca, %1
0B1F68 CA3B0666 5C0B0111 
0B1F70 FF9E658F 69AE62F8   A   195    		DL	%8f659eff, %f862ae69, %616bffd3, %1
0B1F78 D3FF6B61 45CF6C16 
0B1F80 78E20AA0 EED20DD7   A   196    		DL	%a00ae278, %d70dd2ee, %4e048354, %3
0B1F88 5483044E C2B30339 
0B1F90 612667A7 F71660D0   A   197    		DL	%a7672661, %d06016f7, %4969474d, %3
0B1F98 4D476949 DB776E3E 
0B1FA0 4A6AD1AE DC5AD6D9   A   198    		DL	%aed16a4a, %d9d65adc, %40df0b66, %3
0B1FA8 660BDF40 F03BD837 
0B1FB0 53AEBCA9 C59EBBDE   A   199    		DL	%a9bcae53, %debb9ec5, %47b2cf7f, %3
0B1FB8 7FCFB247 E9FFB530 
0B1FC0 1CF2BDBD 8AC2BACA   A   200    		DL	%bdbdf21c, %cabac28a, %53b39330, %2
0B1FC8 3093B353 A6A3B424 
0B1FD0 0536D0BA 9306D7CD   A   201    		DL	%bad03605, %cdd70693, %54de5729, %2
0B1FD8 2957DE54 BF67D923 
0B1FE0 2E7A66B3 B84A61C4   A   202    		DL	%b3667a2e, %c4614ab8, %5d681b02, %2
0B1FE8 021B685D 942B6F2A 
0B1FF0 37BE0BB4 A18E0CC3   A   203    		DL	%b40bbe37, %c30c8ea1, %5a05df1b, %2
0B1FF8 1BDF055A 8DEF022D 
                           A   204    
0B2000                     A   205    crc32result:
0B2000                     A   206    	DS 4
                           A   207    
                           A   208    		END


Errors: 0
Warnings: 0
Lines Assembled: 209
